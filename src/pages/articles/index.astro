---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/Layout.astro';
import TerminalWindow from '@components/TerminalWindow.astro';

const articles = await getCollection('articles');
articles.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const categorizedArticles = articles.reduce((acc, article) => {
  const category = article.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(article);
  return acc;
}, {} as Record<string, typeof articles>);
---

<BaseLayout title="Articles | Genix">
  <TerminalWindow command="ls articles">
    <div class="space-y-6">
      {Object.entries(categorizedArticles).map(([category, categoryArticles]) => (
        <div class="space-y-3">
          <div class="text-gray-600 text-xs uppercase tracking-wider">{category}</div>
          <div class="space-y-4">
            {categoryArticles.map((article) => (
              <div class="space-y-1">
                <div class="flex items-baseline gap-2">
                  <a href={article.data.links ? Object.values(article.data.links)[0] : `/articles/${article.slug}`} 
                     class="text-gray-300 hover:text-gray-100 transition-colors"
                     target={article.data.links ? "_blank" : undefined}
                     rel={article.data.links ? "noopener" : undefined}>
                    {article.data.title}
                  </a>
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-600">
                  <span>{article.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
                  {article.data.tags.length > 0 && (
                    <>
                      <span class="text-gray-800">â€¢</span>
                      <div class="flex gap-1">
                        {article.data.tags.slice(0, 3).map((tag: string) => (
                          <span class="text-gray-700">{tag}</span>
                        ))}
                      </div>
                    </>
                  )}
                </div>
                <p class="text-sm text-gray-500 leading-relaxed">{article.data.description}</p>
                {article.data.links && (
                  <div class="flex gap-2 text-xs">
                    {Object.entries(article.data.links).map(([platform, url]) => (
                      <a href={url} target="_blank" rel="noopener" 
                         class="text-gray-600 hover:text-gray-400 transition-colors">
                        [{platform}]
                      </a>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      ))}

      {articles.length === 0 && (
        <div class="text-center py-8 text-gray-600">
          <p>No articles found.</p>
        </div>
      )}
    </div>
  </TerminalWindow>
</BaseLayout>